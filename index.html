<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ã‚¯ã‚¤ã‚ºãƒ“ãƒ«ãƒ€ãƒ¼</title>
  <link rel="stylesheet" href="assets/css/index.css">
</head>
<body>
  <div class="builder-container">
    <!-- å·¦ã‚µã‚¤ãƒ‰ãƒãƒ¼ -->
    <aside class="sidebar-left">
      <div class="sidebar-header">
        <h1>ğŸ“ ã‚¯ã‚¤ã‚ºãƒ“ãƒ«ãƒ€ãƒ¼</h1>
        <div class="version">Version 1.1 MVP</div>
      </div>
      
      <nav class="sidebar-tabs">
        <button class="tab-button active" data-tab="questions">
          ğŸ“‹ å•é¡Œç®¡ç†
        </button>
        <button class="tab-button" data-tab="upload">
          ğŸ“ ãƒ•ã‚¡ã‚¤ãƒ«èª­ã¿è¾¼ã¿
        </button>
        <button class="tab-button" data-tab="design">
          ğŸ¨ ãƒ‡ã‚¶ã‚¤ãƒ³è¨­å®š
        </button>
        <button class="tab-button" data-tab="export">
          ğŸ“¦ æ›¸ãå‡ºã—
        </button>
      </nav>
    </aside>
    
    <!-- ä¸­å¤®ã‚¨ãƒªã‚¢ -->
    <main class="main-area">
      <header class="main-header">
        <h2 id="current-tab-title">å•é¡Œç®¡ç†</h2>
        <div class="action-buttons">
          <button class="btn btn-primary" onclick="saveQuiz()">ğŸ’¾ ä¿å­˜</button>
          <button class="btn btn-success" onclick="previewQuiz()">â–¶ï¸ ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼</button>
        </div>
      </header>
      
      <div class="main-content">
        <!-- å•é¡Œç®¡ç†ã‚¿ãƒ– -->
        <div id="tab-questions" class="tab-content active">
          <div id="question-list">
            <!-- ã“ã“ã«å•é¡Œãƒªã‚¹ãƒˆãŒè¡¨ç¤ºã•ã‚Œã‚‹ -->
          </div>
        </div>
        
        <!-- ãƒ•ã‚¡ã‚¤ãƒ«èª­ã¿è¾¼ã¿ã‚¿ãƒ– -->
        <div id="tab-upload" class="tab-content">
          <div class="upload-section">
            <h3>ğŸ“ CSVãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰å•é¡Œã‚’èª­ã¿è¾¼ã¿</h3>
            <p>CSVãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰ä¸€æ‹¬ã§å•é¡Œã‚’èª­ã¿è¾¼ã‚€ã“ã¨ãŒã§ãã¾ã™ã€‚è¤‡æ•°æ­£è§£(è¡¨è¨˜ã‚†ã‚Œ)ã«ã‚‚å¯¾å¿œã—ã¦ã„ã¾ã™ã€‚</p>
            
            <!-- ã‚µãƒ³ãƒ—ãƒ«ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ -->
            <div class="upload-card">
              <div class="upload-card-header">
                <h4>ğŸ“¥ ã‚µãƒ³ãƒ—ãƒ«CSVã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰</h4>
              </div>
              <p>ã¾ãšã¯ã‚µãƒ³ãƒ—ãƒ«ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¦ã€ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚</p>
              <button class="btn btn-primary btn-block" onclick="downloadSampleCSV()">
                ğŸ“¥ ã‚µãƒ³ãƒ—ãƒ«CSVã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
              </button>
            </div>
            
            <!-- CSVã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ -->
            <div class="upload-card">
              <div class="upload-card-header">
                <h4>ğŸ“¤ CSVãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰</h4>
              </div>
              <p>ä½œæˆã—ãŸCSVãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠã—ã¦ã€å•é¡Œã‚’èª­ã¿è¾¼ã¿ã¾ã™ã€‚</p>
              <button class="btn btn-success btn-block" onclick="selectCSVFile()">
                ğŸ“ CSVãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠ
              </button>
            </div>
            
            <!-- ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆèª¬æ˜ -->
            <div class="upload-info">
              <h4>ğŸ“‹ CSVãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ</h4>
              <div class="format-example">
                <p><strong>å¿…é ˆã‚«ãƒ©ãƒ :</strong></p>
                <ul>
                  <li><code>type</code> - å•é¡Œå½¢å¼ (choice ã¾ãŸã¯ text)</li>
                  <li><code>question</code> - è³ªå•æ–‡</li>
                  <li><code>answer</code> - æ­£è§£</li>
                </ul>
                
                <p><strong>choiceå‹ã®å ´åˆ:</strong></p>
                <ul>
                  <li><code>choice1, choice2, choice3, choice4</code> - 4ã¤ã®é¸æŠè‚¢(å¿…é ˆ)</li>
                  <li><code>answer</code> - æ­£è§£ã®ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ (0ã€œ3ã®æ•°å­—)</li>
                </ul>
                
                <p><strong>textå‹ã®å ´åˆ:</strong></p>
                <ul>
                  <li><code>answer</code> - æ­£è§£ã®æ–‡å­—åˆ—</li>
                  <li><code>answer2, answer3...</code> - è¿½åŠ ã®æ­£è§£ãƒ‘ã‚¿ãƒ¼ãƒ³(ä»»æ„) ğŸ†•</li>
                  <li>choice1ã€œ4ã¯ç©ºæ¬„ã§OK</li>
                </ul>
                
                <p><strong>ä»»æ„ã‚«ãƒ©ãƒ :</strong></p>
                <ul>
                  <li><code>explanation</code> - è§£èª¬æ–‡(ç©ºæ¬„å¯)</li>
                </ul>
              </div>
              
              <div class="format-example">
                <p><strong>ğŸ†• è¤‡æ•°æ­£è§£ã®ä¾‹:</strong></p>
                <pre><code>type,question,choice1,choice2,choice3,choice4,answer,answer2,answer3,explanation
        text,æ—¥æœ¬ã®é¦–éƒ½ã¯?,,,,,æ±äº¬,tokyo,ãƒˆã‚¦ã‚­ãƒ§ã‚¦,è¡¨è¨˜ã‚†ã‚Œã«å¯¾å¿œ
        text,å††å‘¨ç‡ã¯?,,,,,3.14,3.141592,Ï€,è¤‡æ•°ã®ç­”ãˆæ–¹ã«å¯¾å¿œ</code></pre>
                <p class="note">ğŸ’¡ answer2, answer3ã®ã„ãšã‚Œã‹ã«ä¸€è‡´ã™ã‚Œã°æ­£è§£ã«ãªã‚Šã¾ã™ã€‚å¤§æ–‡å­—å°æ–‡å­—ã¯åŒºåˆ¥ã—ã¾ã›ã‚“ã€‚</p>
              </div>
              
              <div class="format-example">
                <p><strong>åŸºæœ¬çš„ãªä¾‹:</strong></p>
                <pre><code>type,question,choice1,choice2,choice3,choice4,answer,answer2,answer3,explanation
        choice,æ—¥æœ¬ã§ä¸€ç•ªé«˜ã„å±±ã¯?,å¯Œå£«å±±,åŒ—å²³,æ§ãƒ¶å²³,ç«‹å±±,0,,,å¯Œå£«å±±ã¯æ¨™é«˜3776mã§ã™
        text,æ—¥æœ¬ã®é¦–éƒ½ã¯?,,,,,æ±äº¬,,,1868å¹´ã‹ã‚‰é¦–éƒ½ã§ã™</code></pre>
              </div>
            </div>
          </div>
        </div>
        
        <!-- ğŸ†• ãƒ‡ã‚¶ã‚¤ãƒ³è¨­å®šã‚¿ãƒ–(è¡¨ç¤ºå½¢å¼é¸æŠUIè¿½åŠ ) -->
        <div id="tab-design" class="tab-content">
          <div class="design-section">
            <h3>ğŸ¨ è¡¨ç¤ºå½¢å¼ã®è¨­å®š</h3>
            <p>ã‚¯ã‚¤ã‚ºã®è¡¨ç¤ºæ–¹æ³•ã‚’é¸æŠã—ã¦ãã ã•ã„ã€‚</p>
            
            <div class="display-type-selector">
              <div class="display-option">
                <input 
                  type="radio" 
                  id="display-sequential" 
                  name="displayType" 
                  value="sequential" 
                  checked
                  onchange="changeDisplayType('sequential')"
                >
                <label for="display-sequential">
                  <div class="option-header">
                    <span class="option-icon">ğŸ“–</span>
                    <strong>1å•ãšã¤è¡¨ç¤º</strong>
                    <span class="badge badge-default">ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ</span>
                  </div>
                  <p class="option-description">
                    1å•ãšã¤è¡¨ç¤ºã—ã€å›ç­”å¾Œã«ã€Œæ¬¡ã¸ã€ãƒœã‚¿ãƒ³ã§é€²ã¿ã¾ã™ã€‚<br>
                    å­¦ç¿’ç”¨ãƒ»ç·´ç¿’ç”¨ã«é©ã—ã¦ã„ã¾ã™ã€‚
                  </p>
                </label>
              </div>
              
              <div class="display-option">
                <input 
                  type="radio" 
                  id="display-list" 
                  name="displayType" 
                  value="list"
                  onchange="changeDisplayType('list')"
                >
                <label for="display-list">
                  <div class="option-header">
                    <span class="option-icon">ğŸ“‹</span>
                    <strong>ä¸€è¦§è¡¨ç¤º</strong>
                    <span class="badge badge-info">ãƒ†ã‚¹ãƒˆå½¢å¼</span>
                  </div>
                  <p class="option-description">
                    å…¨å•é¡Œã‚’ä¸€åº¦ã«è¡¨ç¤ºã—ã€å…¨å•å›ç­”å¾Œã«ã€Œæ¡ç‚¹ã€ãƒœã‚¿ãƒ³ã§ä¸€æ‹¬åˆ¤å®šã—ã¾ã™ã€‚<br>
                    ãƒ†ã‚¹ãƒˆãƒ»è©¦é¨“ç”¨ã«é©ã—ã¦ã„ã¾ã™ã€‚
                  </p>
                </label>
              </div>
            </div>
            
            <div class="current-setting">
              <strong>ç¾åœ¨ã®è¨­å®š:</strong>
              <span id="current-display-type">1å•ãšã¤è¡¨ç¤º</span>
            </div>
          </div>
        </div>
        
        <!-- æ›¸ãå‡ºã—ã‚¿ãƒ– -->
        <div id="tab-export" class="tab-content">
          <div class="export-section">
            <h3>ğŸ“¦ WordPressç”¨ãƒ•ã‚¡ã‚¤ãƒ«ã®æ›¸ãå‡ºã—</h3>
            <p>ä½œæˆã—ãŸã‚¯ã‚¤ã‚ºã‚’WordPressã§ä½¿ãˆã‚‹ãƒ•ã‚¡ã‚¤ãƒ«ã¨ã—ã¦ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¾ã™ã€‚</p>
            
            <div class="export-options">
              <!-- ã‚ªãƒ¼ãƒ«ã‚¤ãƒ³ãƒ¯ãƒ³ç‰ˆ -->
              <div class="export-card">
                <div class="export-card-header">
                  <h4>â­ ã‚ªãƒ¼ãƒ«ã‚¤ãƒ³ãƒ¯ãƒ³ç‰ˆ(ãŠã™ã™ã‚)</h4>
                  <span class="badge badge-success">åˆå¿ƒè€…å‘ã‘</span>
                </div>
                <p>HTML 1ãƒ•ã‚¡ã‚¤ãƒ«ã ã‘ã§ã‚¯ã‚¤ã‚ºãŒå‹•ä½œã—ã¾ã™ã€‚WordPressã«ã‚³ãƒ”ãƒšã™ã‚‹ã ã‘ã§OK!</p>
                <button class="btn btn-success btn-block" onclick="exportAllInOne()">
                  ğŸ“¥ ã‚ªãƒ¼ãƒ«ã‚¤ãƒ³ãƒ¯ãƒ³ç‰ˆã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
                </button>
              </div>
              
              <!-- åˆ†é›¢ç‰ˆ -->
              <div class="export-card">
                <div class="export-card-header">
                  <h4>ğŸ“‚ åˆ†é›¢ç‰ˆ</h4>
                  <span class="badge badge-info">ä¸­ç´šè€…å‘ã‘</span>
                </div>
                <p>HTMLã€CSSã€JavaScriptã‚’åˆ¥ã€…ã«ç®¡ç†ã—ãŸã„å ´åˆã«ä½¿ç”¨ã—ã¾ã™ã€‚</p>
                <button class="btn btn-primary btn-block" onclick="exportSeparate()">
                  ğŸ“¥ åˆ†é›¢ç‰ˆã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰(3ãƒ•ã‚¡ã‚¤ãƒ«)
                </button>
              </div>
              
              <!-- ã¾ã¨ã‚ã¦ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ -->
              <div class="export-card">
                <div class="export-card-header">
                  <h4>ğŸ“¦ å…¨ãƒ‘ã‚¿ãƒ¼ãƒ³</h4>
                </div>
                <p>ã‚ªãƒ¼ãƒ«ã‚¤ãƒ³ãƒ¯ãƒ³ç‰ˆã¨åˆ†é›¢ç‰ˆã®ä¸¡æ–¹ã‚’ã¾ã¨ã‚ã¦ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¾ã™ã€‚</p>
                <button class="btn btn-primary btn-block" onclick="exportAll()">
                  ğŸ“¥ å…¨ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰(4ãƒ•ã‚¡ã‚¤ãƒ«)
                </button>
              </div>
            </div>
            
            <!-- ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ -->
            <div class="export-preview">
              <h4>ğŸ“‹ ã‚¯ã‚¤ã‚ºæƒ…å ±</h4>
              <div class="quiz-info">
                <div class="info-item">
                  <span class="info-label">ã‚¿ã‚¤ãƒˆãƒ«:</span>
                  <span class="info-value" id="export-title">-</span>
                </div>
                <div class="info-item">
                  <span class="info-label">å•é¡Œæ•°:</span>
                  <span class="info-value" id="export-count">-</span>
                </div>
                <div class="info-item">
                  <span class="info-label">choiceå‹:</span>
                  <span class="info-value" id="export-choice-count">-</span>
                </div>
                <div class="info-item">
                  <span class="info-label">textå‹:</span>
                  <span class="info-value" id="export-text-count">-</span>
                </div>
                <div class="info-item">
                  <span class="info-label">è¡¨ç¤ºå½¢å¼:</span>
                  <span class="info-value" id="export-display-type">-</span>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </main>
    
    <!-- å³ã‚µã‚¤ãƒ‰ãƒãƒ¼(ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼) -->
    <aside class="sidebar-right">
      <div class="preview-header">
        <h3>ğŸ‘ï¸ ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼</h3>
      </div>
      <div class="preview-content">
        <div id="preview-area">
          <div class="placeholder">
            <h3>ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼</h3>
            <p>ã‚¯ã‚¤ã‚ºã®ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ãŒã“ã“ã«è¡¨ç¤ºã•ã‚Œã¾ã™</p>
          </div>
        </div>
      </div>
    </aside>
  </div>

  <!-- ç·¨é›†ãƒ¢ãƒ¼ãƒ€ãƒ« (ç”»åƒå¯¾å¿œç‰ˆ) -->
<!-- index.htmlã®æ—¢å­˜ã®ç·¨é›†ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’ä»¥ä¸‹ã§ç½®ãæ›ãˆã¦ãã ã•ã„ -->

<div id="edit-modal" class="modal">
  <div class="modal-content">
    <div class="modal-header">
      <h2 id="modal-title">å•é¡Œã‚’ç·¨é›†</h2>
      <button class="modal-close" onclick="closeEditModal()">âœ•</button>
    </div>
    
    <div class="modal-body">
      <form id="question-form">
        <!-- å•é¡Œã‚¿ã‚¤ãƒ—é¸æŠ -->
        <div class="form-group">
          <label>å•é¡Œã‚¿ã‚¤ãƒ—</label>
          <select id="edit-type" onchange="toggleQuestionType()">
            <option value="choice">4æŠã‚¯ã‚¤ã‚º</option>
            <option value="text">ãƒ†ã‚­ã‚¹ãƒˆå…¥åŠ›</option>
          </select>
        </div>
        
        <!-- å•é¡Œæ–‡ -->
        <div class="form-group">
          <label>å•é¡Œæ–‡ <span class="required">*</span></label>
          <textarea id="edit-question" rows="3" placeholder="å•é¡Œæ–‡ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„" required></textarea>
        </div>
        
        <!-- ğŸ†• å•é¡Œç”»åƒ -->
        <div class="form-group">
          <label>å•é¡Œç”»åƒ (ä»»æ„)</label>
          <div class="image-upload-area">
            <div id="question-image-preview" class="image-preview-area">
              <p class="no-image">ç”»åƒãªã—</p>
            </div>
            <div class="image-upload-buttons">
              <button type="button" class="btn btn-sm btn-primary" onclick="uploadQuestionImage()">
                ğŸ“ ãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰é¸æŠ
              </button>
              <button type="button" class="btn btn-sm btn-secondary" onclick="uploadQuestionImageByURL()">
                ğŸ”— URLã§è¿½åŠ 
              </button>
            </div>
          </div>
        </div>
        
        <!-- choiceå‹ã®å ´åˆã®é¸æŠè‚¢ -->
        <div id="choices-area">
          <div class="form-group">
            <label>é¸æŠè‚¢</label>
            <div class="choice-inputs">
              <!-- é¸æŠè‚¢1 -->
              <div class="choice-input-group">
                <div class="choice-input-row">
                  <input type="text" id="edit-choice-0" placeholder="é¸æŠè‚¢1">
                  <input type="radio" name="correct-answer" value="0">
                </div>
                <div class="choice-image-area">
                  <div id="choice-image-preview-0" class="choice-image-preview">
                    <p class="no-image-small">ç”»åƒãªã—</p>
                  </div>
                  <button type="button" class="btn-image-upload" onclick="uploadChoiceImage(0)">
                    ğŸ–¼ï¸ ç”»åƒ
                  </button>
                </div>
              </div>
              
              <!-- é¸æŠè‚¢2 -->
              <div class="choice-input-group">
                <div class="choice-input-row">
                  <input type="text" id="edit-choice-1" placeholder="é¸æŠè‚¢2">
                  <input type="radio" name="correct-answer" value="1">
                </div>
                <div class="choice-image-area">
                  <div id="choice-image-preview-1" class="choice-image-preview">
                    <p class="no-image-small">ç”»åƒãªã—</p>
                  </div>
                  <button type="button" class="btn-image-upload" onclick="uploadChoiceImage(1)">
                    ğŸ–¼ï¸ ç”»åƒ
                  </button>
                </div>
              </div>
              
              <!-- é¸æŠè‚¢3 -->
              <div class="choice-input-group">
                <div class="choice-input-row">
                  <input type="text" id="edit-choice-2" placeholder="é¸æŠè‚¢3">
                  <input type="radio" name="correct-answer" value="2">
                </div>
                <div class="choice-image-area">
                  <div id="choice-image-preview-2" class="choice-image-preview">
                    <p class="no-image-small">ç”»åƒãªã—</p>
                  </div>
                  <button type="button" class="btn-image-upload" onclick="uploadChoiceImage(2)">
                    ğŸ–¼ï¸ ç”»åƒ
                  </button>
                </div>
              </div>
              
              <!-- é¸æŠè‚¢4 -->
              <div class="choice-input-group">
                <div class="choice-input-row">
                  <input type="text" id="edit-choice-3" placeholder="é¸æŠè‚¢4">
                  <input type="radio" name="correct-answer" value="3">
                </div>
                <div class="choice-image-area">
                  <div id="choice-image-preview-3" class="choice-image-preview">
                    <p class="no-image-small">ç”»åƒãªã—</p>
                  </div>
                  <button type="button" class="btn-image-upload" onclick="uploadChoiceImage(3)">
                    ğŸ–¼ï¸ ç”»åƒ
                  </button>
                </div>
              </div>
            </div>
            <small>æ­£è§£ã®é¸æŠè‚¢ã®æ¨ªã®ãƒ©ã‚¸ã‚ªãƒœã‚¿ãƒ³ã‚’ãƒã‚§ãƒƒã‚¯ã—ã¦ãã ã•ã„</small>
          </div>
        </div>
        
        <!-- textå‹ã®å ´åˆã®æ­£è§£ -->
        <div id="text-answer-area" style="display: none;">
          <div class="form-group">
            <label>æ­£è§£ <span class="required">*</span></label>
            <input type="text" id="edit-text-answer" placeholder="æ­£è§£ã®æ–‡å­—åˆ—ã‚’å…¥åŠ›">
          </div>
        </div>
        
        <!-- è§£èª¬ -->
        <div class="form-group">
          <label>è§£èª¬(ä»»æ„)</label>
          <textarea id="edit-explanation" rows="3" placeholder="è§£èª¬ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„(çœç•¥å¯)"></textarea>
        </div>
      </form>
    </div>
    
    <div class="modal-footer">
      <button class="btn" onclick="closeEditModal()">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
      <button class="btn btn-primary" onclick="saveQuestion()">ä¿å­˜</button>
    </div>
  </div>
</div>

<style>
  /* ãƒ¢ãƒ¼ãƒ€ãƒ«åŸºæœ¬ã‚¹ã‚¿ã‚¤ãƒ« */
  .modal {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.5);
    z-index: 1000;
    overflow-y: auto;
  }
  
  .modal.show {
    display: flex;
    align-items: center;
    justify-content: center;
  }
  
  .modal-content {
    background: white;
    border-radius: 12px;
    width: 90%;
    max-width: 700px;
    max-height: 90vh;
    display: flex;
    flex-direction: column;
    box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
  }
  
  .modal-header {
    padding: 20px;
    border-bottom: 2px solid #e0e0e0;
    display: flex;
    justify-content: space-between;
    align-items: center;
  }
  
  .modal-header h2 {
    font-size: 20px;
    color: #2c3e50;
  }
  
  .modal-close {
    background: none;
    border: none;
    font-size: 24px;
    cursor: pointer;
    color: #7f8c8d;
    padding: 0;
    width: 30px;
    height: 30px;
  }
  
  .modal-close:hover {
    color: #e74c3c;
  }
  
  .modal-body {
    padding: 20px;
    overflow-y: auto;
    flex: 1;
  }
  
  .modal-footer {
    padding: 20px;
    border-top: 2px solid #e0e0e0;
    display: flex;
    justify-content: flex-end;
    gap: 10px;
  }
  
  /* ãƒ•ã‚©ãƒ¼ãƒ ã‚¹ã‚¿ã‚¤ãƒ« */
  .form-group {
    margin-bottom: 20px;
  }
  
  .form-group label {
    display: block;
    font-weight: bold;
    color: #2c3e50;
    margin-bottom: 8px;
  }
  
  .form-group .required {
    color: #e74c3c;
  }
  
  .form-group input[type="text"],
  .form-group textarea,
  .form-group select {
    width: 100%;
    padding: 10px;
    border: 2px solid #bdc3c7;
    border-radius: 6px;
    font-size: 14px;
  }
  
  .form-group small {
    color: #7f8c8d;
    font-size: 12px;
  }
  
  /* ğŸ†• ç”»åƒã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã‚¨ãƒªã‚¢ */
  .image-upload-area {
    border: 2px dashed #bdc3c7;
    border-radius: 8px;
    padding: 15px;
    background: #f8f9fa;
  }
  
  .image-preview-area {
    min-height: 150px;
    display: flex;
    align-items: center;
    justify-content: center;
    margin-bottom: 10px;
    background: white;
    border-radius: 6px;
  }
  
  .image-preview-container {
    position: relative;
    display: inline-block;
  }
  
  .image-preview {
    max-width: 100%;
    max-height: 300px;
    border-radius: 6px;
    display: block;
  }
  
  .btn-delete-image {
    position: absolute;
    top: 5px;
    right: 5px;
    padding: 5px 10px;
    background: #e74c3c;
    color: white;
    border: none;
    border-radius: 4px;
    cursor: pointer;
    font-size: 12px;
  }
  
  .btn-delete-image:hover {
    background: #c0392b;
  }
  
  .no-image {
    color: #95a5a6;
    font-style: italic;
  }
  
  .image-upload-buttons {
    display: flex;
    gap: 10px;
  }
  
  .btn-sm {
    padding: 8px 15px;
    font-size: 13px;
  }
  
  .btn-secondary {
    background: #95a5a6;
    color: white;
  }
  
  .btn-secondary:hover {
    background: #7f8c8d;
  }
  
  /* é¸æŠè‚¢ç”»åƒã‚¨ãƒªã‚¢ */
  .choice-input-group {
    margin-bottom: 15px;
  }
  
  .choice-input-row {
    display: flex;
    gap: 10px;
    align-items: center;
    margin-bottom: 8px;
  }
  
  .choice-input-row input[type="text"] {
    flex: 1;
  }
  
  .choice-input-row input[type="radio"] {
    width: 20px;
    height: 20px;
  }
  
  .choice-image-area {
    display: flex;
    gap: 10px;
    align-items: center;
    padding-left: 10px;
  }
  
  .choice-image-preview {
    flex: 1;
    min-height: 60px;
    background: #f8f9fa;
    border: 1px solid #e0e0e0;
    border-radius: 4px;
    display: flex;
    align-items: center;
    justify-content: center;
    overflow: hidden;
  }
  
  .choice-image-preview img {
    max-width: 100%;
    max-height: 100px;
    display: block;
  }
  
  .no-image-small {
    color: #bdc3c7;
    font-size: 11px;
    font-style: italic;
  }
  
  .btn-image-upload {
    padding: 6px 12px;
    background: #3498db;
    color: white;
    border: none;
    border-radius: 4px;
    cursor: pointer;
    font-size: 12px;
    white-space: nowrap;
  }
  
  .btn-image-upload:hover {
    background: #2980b9;
  }
  
  .choice-image-preview .image-preview-container {
    width: 100%;
    height: 100%;
  }
  
  .choice-image-preview .btn-delete-image {
    font-size: 10px;
    padding: 3px 6px;
  }
</style>
    <!-- ãƒ¢ãƒ¼ãƒ€ãƒ«ã®å†…å®¹ã¯çœç•¥(builder.jsã§åˆ¶å¾¡) -->
  </div>

  <!-- ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ãƒ¢ãƒ¼ãƒ€ãƒ« -->
  <div id="preview-modal" class="modal" style="display: none;">
    <div class="modal-content preview-modal-content">
      <div class="modal-header">
        <h2>ğŸ‘ï¸ ã‚¯ã‚¤ã‚ºãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼</h2>
        <button class="modal-close" onclick="closePreviewModal()">&times;</button>
      </div>
      
      <div class="preview-tabs">
        <button class="preview-tab active" data-preview-tab="list" onclick="switchPreviewTab('list')">
          ğŸ“‹ å•é¡Œä¸€è¦§
        </button>
        <button class="preview-tab" data-preview-tab="quiz" onclick="switchPreviewTab('quiz')">
          â–¶ï¸ ã‚¯ã‚¤ã‚ºå®Ÿè¡Œ
        </button>
      </div>
      
      <div id="preview-tab-list" class="preview-tab-content active">
        <div id="preview-question-list"></div>
      </div>
      
      <div id="preview-tab-quiz" class="preview-tab-content">
        <div id="preview-quiz-container"></div>
      </div>
    </div>
  </div>

  <style>
    /* ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ãƒ¢ãƒ¼ãƒ€ãƒ«ã®ã‚¹ã‚¿ã‚¤ãƒ« */
    .modal {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.7);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 10000;
    }
    
    .preview-modal-content {
      background: white;
      width: 90%;
      max-width: 900px;
      max-height: 90vh;
      border-radius: 12px;
      overflow: hidden;
      display: flex;
      flex-direction: column;
    }
    
    .modal-header {
      padding: 20px 30px;
      border-bottom: 2px solid #e0e0e0;
      display: flex;
      justify-content: space-between;
      align-items: center;
      background: #f8f9fa;
    }
    
    .modal-header h2 {
      margin: 0;
      font-size: 24px;
    }
    
    .modal-close {
      background: none;
      border: none;
      font-size: 32px;
      cursor: pointer;
      color: #666;
      padding: 0;
      width: 40px;
      height: 40px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 50%;
      transition: background 0.2s;
    }
    
    .modal-close:hover {
      background: rgba(0, 0, 0, 0.1);
    }
    
    .preview-tabs {
      display: flex;
      border-bottom: 2px solid #e0e0e0;
      background: #f8f9fa;
    }
    
    .preview-tab {
      flex: 1;
      padding: 15px;
      background: transparent;
      border: none;
      cursor: pointer;
      font-size: 16px;
      font-weight: 500;
      transition: all 0.2s;
      border-bottom: 3px solid transparent;
    }
    
    .preview-tab:hover {
      background: rgba(0, 0, 0, 0.05);
    }
    
    .preview-tab.active {
      background: white;
      border-bottom-color: #3498db;
      color: #3498db;
    }
    
    .preview-tab-content {
      display: none;
      padding: 30px;
      overflow-y: auto;
      flex: 1;
    }
    
    .preview-tab-content.active {
      display: block;
    }
    
    /* å•é¡Œä¸€è¦§ã‚¹ã‚¿ã‚¤ãƒ« */
    .preview-question-item {
      background: #f8f9fa;
      padding: 20px;
      margin-bottom: 15px;
      border-radius: 8px;
      border-left: 4px solid #3498db;
    }
    
    .preview-question-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 12px;
    }
    
    .preview-question-number {
      font-weight: bold;
      color: #3498db;
      font-size: 14px;
    }
    
    .preview-question-type {
      padding: 4px 12px;
      border-radius: 12px;
      font-size: 12px;
      font-weight: 500;
    }
    
    .preview-question-type.choice {
      background: #e8f4f8;
      color: #2980b9;
    }
    
    .preview-question-type.text {
      background: #fef5e7;
      color: #d68910;
    }
    
    .preview-question-text {
      font-size: 16px;
      font-weight: 500;
      margin-bottom: 12px;
      color: #2c3e50;
    }
    
    .preview-choices {
      margin-left: 20px;
    }
    
    .preview-choice {
      padding: 8px 12px;
      margin: 6px 0;
      background: white;
      border: 1px solid #ddd;
      border-radius: 4px;
      font-size: 14px;
    }
    
    .preview-choice.correct {
      background: #d5f4e6;
      border-color: #27ae60;
      font-weight: 500;
    }
    
    .preview-answer {
      margin-top: 10px;
      padding: 10px;
      background: #d5f4e6;
      border-radius: 4px;
      font-size: 14px;
    }
    
    .preview-answer strong {
      color: #27ae60;
    }
    
    .preview-explanation {
      margin-top: 10px;
      padding: 10px;
      background: #fff3cd;
      border-radius: 4px;
      font-size: 13px;
      color: #856404;
    }
    
    /* ã‚¯ã‚¤ã‚ºå®Ÿè¡Œã‚¹ã‚¿ã‚¤ãƒ« */
    .quiz-header {
      background: #3498db;
      color: white;
      padding: 20px;
      border-radius: 8px;
      margin-bottom: 30px;
      text-align: center;
    }
    
    .quiz-progress {
      font-size: 18px;
      font-weight: bold;
      margin-bottom: 10px;
    }
    
    .quiz-progress-bar {
      background: rgba(255, 255, 255, 0.3);
      height: 8px;
      border-radius: 4px;
      overflow: hidden;
    }
    
    .quiz-progress-fill {
      background: white;
      height: 100%;
      transition: width 0.3s;
    }
    
    .quiz-question-card {
      background: #f8f9fa;
      padding: 30px;
      border-radius: 12px;
      margin-bottom: 20px;
    }
    
    .quiz-question-text {
      font-size: 20px;
      font-weight: 600;
      color: #2c3e50;
      margin-bottom: 25px;
      line-height: 1.6;
    }
    
    .quiz-choices {
      display: flex;
      flex-direction: column;
      gap: 12px;
    }
    
    .quiz-choice-button {
      padding: 15px 20px;
      background: white;
      border: 2px solid #ddd;
      border-radius: 8px;
      font-size: 16px;
      text-align: left;
      cursor: pointer;
      transition: all 0.2s;
    }
    
    .quiz-choice-button:hover {
      border-color: #3498db;
      background: #f0f8ff;
    }
    
    .quiz-choice-button.selected {
      border-color: #3498db;
      background: #e8f4f8;
    }
    
    .quiz-choice-button.correct {
      border-color: #27ae60;
      background: #d5f4e6;
    }
    
    .quiz-choice-button.incorrect {
      border-color: #e74c3c;
      background: #fadbd8;
    }
    
    .quiz-text-input {
      width: 100%;
      padding: 15px;
      font-size: 16px;
      border: 2px solid #ddd;
      border-radius: 8px;
      transition: border-color 0.2s;
    }
    
    .quiz-text-input:focus {
      outline: none;
      border-color: #3498db;
    }
    
    .quiz-buttons {
      display: flex;
      gap: 15px;
      margin-top: 25px;
    }
    
    .quiz-button {
      flex: 1;
      padding: 15px;
      font-size: 16px;
      font-weight: 600;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.2s;
    }
    
    .quiz-button-primary {
      background: #3498db;
      color: white;
    }
    
    .quiz-button-primary:hover {
      background: #2980b9;
    }
    
    .quiz-button-success {
      background: #27ae60;
      color: white;
    }
    
    .quiz-button-success:hover {
      background: #229954;
    }
    
    .quiz-button-secondary {
      background: #95a5a6;
      color: white;
    }
    
    .quiz-button-secondary:hover {
      background: #7f8c8d;
    }
    
    .quiz-feedback {
      padding: 20px;
      border-radius: 8px;
      margin-top: 20px;
      font-size: 16px;
    }
    
    .quiz-feedback.correct {
      background: #d5f4e6;
      border: 2px solid #27ae60;
      color: #27ae60;
    }
    
    .quiz-feedback.incorrect {
      background: #fadbd8;
      border: 2px solid #e74c3c;
      color: #c0392b;
    }
    
    .quiz-result {
      text-align: center;
      padding: 40px;
    }
    
    .quiz-result-title {
      font-size: 32px;
      font-weight: bold;
      margin-bottom: 20px;
      color: #2c3e50;
    }
    
    .quiz-result-score {
      font-size: 48px;
      font-weight: bold;
      color: #3498db;
      margin-bottom: 30px;
    }
    
    .quiz-result-message {
      font-size: 18px;
      color: #7f8c8d;
      margin-bottom: 30px;
    }
    
    /* ä¸€è¦§è¡¨ç¤ºãƒ¢ãƒ¼ãƒ‰ç”¨ã‚¹ã‚¿ã‚¤ãƒ« */
    .quiz-list-mode .quiz-question-card {
      margin-bottom: 30px;
    }
    
    .quiz-list-mode .quiz-question-number {
      display: inline-block;
      background: #3498db;
      color: white;
      padding: 5px 15px;
      border-radius: 20px;
      font-weight: bold;
      margin-bottom: 15px;
    }
  </style>

  <!-- JavaScript -->
    <script src="assets/js/data.js"></script>
    <script src="assets/js/builder.js"></script>
    <script src="assets/js/export.js"></script>
    <script src="assets/js/csv-loader.js"></script> 

  <script>
    // ã‚¿ãƒ–åˆ‡ã‚Šæ›¿ãˆæ©Ÿèƒ½
    document.querySelectorAll('.tab-button').forEach(button => {
      button.addEventListener('click', function() {
        const tabName = this.dataset.tab;
        
        document.querySelectorAll('.tab-button').forEach(btn => {
          btn.classList.remove('active');
        });
        this.classList.add('active');
        
        document.querySelectorAll('.tab-content').forEach(content => {
          content.classList.remove('active');
        });
        document.getElementById('tab-' + tabName).classList.add('active');
        
        const titles = {
          'questions': 'å•é¡Œç®¡ç†',
          'upload': 'ãƒ•ã‚¡ã‚¤ãƒ«èª­ã¿è¾¼ã¿',
          'design': 'ãƒ‡ã‚¶ã‚¤ãƒ³è¨­å®š',
          'export': 'æ›¸ãå‡ºã—'
        };
        document.getElementById('current-tab-title').textContent = titles[tabName];
      });
    });
    
    // ä¿å­˜ãƒ»ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ãƒœã‚¿ãƒ³
    function saveQuiz() {
      alert('ğŸ’¾ ä¿å­˜æ©Ÿèƒ½ã¯å®Ÿè£…ä¸­ã§ã™');
    }
    
    function previewQuiz() {
      if (!quizData.questions || quizData.questions.length === 0) {
        alert('âš ï¸ ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã™ã‚‹å•é¡ŒãŒã‚ã‚Šã¾ã›ã‚“ã€‚\n\nå…ˆã«å•é¡Œã‚’è¿½åŠ ã—ã¦ãã ã•ã„ã€‚');
        return;
      }
      
      // ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’é–‹ã
      openPreviewModal();
    }
    
    // ğŸ†• è¡¨ç¤ºå½¢å¼å¤‰æ›´é–¢æ•°
    function changeDisplayType(type) {
      console.log('ğŸ¨ è¡¨ç¤ºå½¢å¼å¤‰æ›´:', type);
      
      if (typeof quizData !== 'undefined') {
        quizData.meta.displayType = type;
        console.log('âœ… quizData.meta.displayType =', type);
      }
      
      const currentDisplayElement = document.getElementById('current-display-type');
      if (currentDisplayElement) {
        if (type === 'sequential') {
          currentDisplayElement.textContent = '1å•ãšã¤è¡¨ç¤º';
        } else if (type === 'list') {
          currentDisplayElement.textContent = 'ä¸€è¦§è¡¨ç¤º';
        }
      }
      
      if (typeof updatePreview === 'function') {
        updatePreview();
      }
      
      if (typeof updateExportInfo === 'function') {
        updateExportInfo();
      }
    }
    
    // æ›¸ãå‡ºã—æ©Ÿèƒ½
    function exportAllInOne() {
      console.log('ğŸ“¥ ã‚ªãƒ¼ãƒ«ã‚¤ãƒ³ãƒ¯ãƒ³ç‰ˆãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰');
      
      if (!validateQuizData()) return;
      
      try {
        exportAllInOneWithDisplayType();
      } catch (error) {
        console.error('âŒ ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã‚¨ãƒ©ãƒ¼:', error);
        alert('âŒ ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰å¤±æ•—: ' + error.message);
      }
    }
    
    function exportSeparate() {
      console.log('ğŸ“¥ åˆ†é›¢ç‰ˆãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰');
      
      if (!validateQuizData()) return;
      
      try {
        downloadAllFiles();
      } catch (error) {
        console.error('âŒ ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã‚¨ãƒ©ãƒ¼:', error);
        alert('âŒ ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰å¤±æ•—: ' + error.message);
      }
    }
    
    function exportAll() {
      console.log('ğŸ“¥ å…¨ãƒ‘ã‚¿ãƒ¼ãƒ³ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰');
      
      if (!validateQuizData()) return;
      
      try {
        downloadAllFilesWithOptions();
      } catch (error) {
        console.error('âŒ ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã‚¨ãƒ©ãƒ¼:', error);
        alert('âŒ ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰å¤±æ•—: ' + error.message);
      }
    }
    
    function validateQuizData() {
      if (!quizData.questions || quizData.questions.length === 0) {
        alert('âš ï¸ å•é¡ŒãŒ1ã¤ã‚‚ã‚ã‚Šã¾ã›ã‚“ã€‚\n\nå…ˆã«å•é¡Œã‚’è¿½åŠ ã—ã¦ãã ã•ã„ã€‚');
        return false;
      }
      return true;
    }
    
    // æ›¸ãå‡ºã—ã‚¿ãƒ–ã®ã‚¯ã‚¤ã‚ºæƒ…å ±ã‚’æ›´æ–°
    function updateExportInfo() {
      if (!quizData || !quizData.questions) return;
      
      const choiceCount = quizData.questions.filter(q => q.type === 'choice').length;
      const textCount = quizData.questions.filter(q => q.type === 'text').length;
      
      const titleElement = document.getElementById('export-title');
      const countElement = document.getElementById('export-count');
      const choiceCountElement = document.getElementById('export-choice-count');
      const textCountElement = document.getElementById('export-text-count');
      const displayTypeElement = document.getElementById('export-display-type');
      
      if (titleElement) titleElement.textContent = quizData.meta.title || '(æœªè¨­å®š)';
      if (countElement) countElement.textContent = quizData.questions.length + 'å•';
      if (choiceCountElement) choiceCountElement.textContent = choiceCount + 'å•';
      if (textCountElement) textCountElement.textContent = textCount + 'å•';
      if (displayTypeElement) {
        const displayType = quizData.meta.displayType || 'sequential';
        displayTypeElement.textContent = displayType === 'list' ? 'ä¸€è¦§è¡¨ç¤º' : '1å•ãšã¤è¡¨ç¤º';
      }
    }
    
    // åˆæœŸåŒ–
    document.addEventListener('DOMContentLoaded', function() {
      console.log('ğŸ¬ ãƒ“ãƒ«ãƒ€ãƒ¼åˆæœŸåŒ–');
      
      if (typeof quizData === 'undefined') {
        console.error('âŒ quizDataãŒèª­ã¿è¾¼ã¾ã‚Œã¦ã„ã¾ã›ã‚“');
        alert('ã‚¨ãƒ©ãƒ¼: data.jsãŒèª­ã¿è¾¼ã¾ã‚Œã¦ã„ã¾ã›ã‚“');
        return;
      }
      
      if (typeof renderQuestionList === 'undefined') {
        console.error('âŒ renderQuestionListãŒèª­ã¿è¾¼ã¾ã‚Œã¦ã„ã¾ã›ã‚“');
        alert('ã‚¨ãƒ©ãƒ¼: builder.jsãŒèª­ã¿è¾¼ã¾ã‚Œã¦ã„ã¾ã›ã‚“');
        return;
      }
      
      console.log('âœ… å¿…è¦ãªãƒ•ã‚¡ã‚¤ãƒ«ãŒå…¨ã¦èª­ã¿è¾¼ã¾ã‚Œã¦ã„ã¾ã™');
      
      // å•é¡Œãƒªã‚¹ãƒˆã‚’è¡¨ç¤º
      renderQuestionList();
      
      // ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚’æ›´æ–°
      updatePreview();
      
      // æ›¸ãå‡ºã—æƒ…å ±ã‚’æ›´æ–°
      updateExportInfo();
      
      // è¡¨ç¤ºå½¢å¼ã®åˆæœŸè¨­å®šã‚’åæ˜ 
      if (quizData.meta.displayType) {
        const displayType = quizData.meta.displayType;
        const radioButton = document.getElementById('display-' + displayType);
        if (radioButton) {
          radioButton.checked = true;
        }
        
        const currentDisplayElement = document.getElementById('current-display-type');
        if (currentDisplayElement) {
          if (displayType === 'sequential') {
            currentDisplayElement.textContent = '1å•ãšã¤è¡¨ç¤º';
          } else if (displayType === 'list') {
            currentDisplayElement.textContent = 'ä¸€è¦§è¡¨ç¤º';
          }
        }
      }
      
      console.log('âœ… ãƒ“ãƒ«ãƒ€ãƒ¼åˆæœŸåŒ–å®Œäº†');
    });
    
    // ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ãƒ¢ãƒ¼ãƒ€ãƒ«é–¢é€£ã®é–¢æ•°
    let previewState = {
      currentQuestionIndex: 0,
      userAnswers: [],
      score: 0,
      isAnswered: false
    };
    
    function openPreviewModal() {
      const modal = document.getElementById('preview-modal');
      modal.style.display = 'flex';
      
      // å•é¡Œä¸€è¦§ã‚’è¡¨ç¤º
      renderPreviewQuestionList();
      
      // ã‚¯ã‚¤ã‚ºå®Ÿè¡Œã‚¿ãƒ–ã¯åˆæœŸåŒ–ã®ã¿
      previewState = {
        currentQuestionIndex: 0,
        userAnswers: [],
        score: 0,
        isAnswered: false
      };
    }
    
    function closePreviewModal() {
      const modal = document.getElementById('preview-modal');
      modal.style.display = 'none';
    }
    
    function switchPreviewTab(tabName) {
      // ã‚¿ãƒ–ãƒœã‚¿ãƒ³ã®åˆ‡ã‚Šæ›¿ãˆ
      document.querySelectorAll('.preview-tab').forEach(tab => {
        tab.classList.remove('active');
      });
      document.querySelector(`[data-preview-tab="${tabName}"]`).classList.add('active');
      
      // ã‚¿ãƒ–ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã®åˆ‡ã‚Šæ›¿ãˆ
      document.querySelectorAll('.preview-tab-content').forEach(content => {
        content.classList.remove('active');
      });
      document.getElementById(`preview-tab-${tabName}`).classList.add('active');
      
      // ã‚¯ã‚¤ã‚ºå®Ÿè¡Œã‚¿ãƒ–ã«åˆ‡ã‚Šæ›¿ãˆãŸæ™‚ã€ã‚¯ã‚¤ã‚ºã‚’åˆæœŸåŒ–
      if (tabName === 'quiz') {
        initQuizPreview();
      }
    }
    
    function renderPreviewQuestionList() {
      const container = document.getElementById('preview-question-list');
      
      if (!quizData.questions || quizData.questions.length === 0) {
        container.innerHTML = '<p style="text-align: center; color: #999;">å•é¡ŒãŒã‚ã‚Šã¾ã›ã‚“</p>';
        return;
      }
      
      let html = '';
      quizData.questions.forEach((q, index) => {
        html += `
          <div class="preview-question-item">
            <div class="preview-question-header">
              <span class="preview-question-number">å•é¡Œ ${index + 1}</span>
              <span class="preview-question-type ${q.type}">${q.type === 'choice' ? 'é¸æŠå¼' : 'è¨˜è¿°å¼'}</span>
            </div>
            <div class="preview-question-text">${q.question}</div>
        `;
        
        if (q.type === 'choice') {
          html += '<div class="preview-choices">';
          q.choices.forEach((choice, i) => {
            const isCorrect = i === parseInt(q.answer);
            html += `<div class="preview-choice ${isCorrect ? 'correct' : ''}">${choice}${isCorrect ? ' âœ“' : ''}</div>`;
          });
          html += '</div>';
        } else {
          // textå‹ã®å ´åˆã€è¤‡æ•°æ­£è§£ã‚’è¡¨ç¤º
          const answers = [q.answer];
          if (q.answer2) answers.push(q.answer2);
          if (q.answer3) answers.push(q.answer3);
          html += `<div class="preview-answer"><strong>æ­£è§£:</strong> ${answers.join(' / ')}</div>`;
        }
        
        if (q.explanation) {
          html += `<div class="preview-explanation">ğŸ’¡ ${q.explanation}</div>`;
        }
        
        html += '</div>';
      });
      
      container.innerHTML = html;
    }
    
    function initQuizPreview() {
      previewState = {
        currentQuestionIndex: 0,
        userAnswers: new Array(quizData.questions.length).fill(null),
        score: 0,
        isAnswered: false
      };
      
      const displayType = quizData.meta.displayType || 'sequential';
      
      if (displayType === 'sequential') {
        renderSequentialQuiz();
      } else {
        renderListQuiz();
      }
    }
    
    function renderSequentialQuiz() {
      const container = document.getElementById('preview-quiz-container');
      const currentQ = quizData.questions[previewState.currentQuestionIndex];
      const progress = ((previewState.currentQuestionIndex + 1) / quizData.questions.length) * 100;
      
      let html = `
        <div class="quiz-header">
          <div class="quiz-progress">å•é¡Œ ${previewState.currentQuestionIndex + 1} / ${quizData.questions.length}</div>
          <div class="quiz-progress-bar">
            <div class="quiz-progress-fill" style="width: ${progress}%"></div>
          </div>
        </div>
        
        <div class="quiz-question-card">
          <div class="quiz-question-text">${currentQ.question}</div>
      `;
      
      if (currentQ.type === 'choice') {
        html += '<div class="quiz-choices">';
        currentQ.choices.forEach((choice, i) => {
          const isSelected = previewState.userAnswers[previewState.currentQuestionIndex] === i;
          const correctAnswer = parseInt(currentQ.answer);
          
          let btnClass = 'quiz-choice-button';
          if (previewState.isAnswered) {
            if (i === correctAnswer) btnClass += ' correct';
            else if (isSelected) btnClass += ' incorrect';
          } else if (isSelected) {
            btnClass += ' selected';
          }
          
          html += `
            <button class="${btnClass}" 
                    onclick="selectChoiceAnswer(${i})"
                    ${previewState.isAnswered ? 'disabled' : ''}>
              ${choice}
            </button>
          `;
        });
        html += '</div>';
      } else {
        const userAnswer = previewState.userAnswers[previewState.currentQuestionIndex] || '';
        html += `
          <input type="text" 
                 class="quiz-text-input" 
                 id="text-answer-input"
                 value="${userAnswer}"
                 ${previewState.isAnswered ? 'disabled' : ''}
                 placeholder="ç­”ãˆã‚’å…¥åŠ›ã—ã¦ãã ã•ã„">
        `;
      }
      
      html += '<div class="quiz-buttons">';
      
      if (!previewState.isAnswered) {
        html += '<button class="quiz-button quiz-button-primary" onclick="checkAnswer()">å›ç­”ã™ã‚‹</button>';
      } else {
        if (previewState.currentQuestionIndex < quizData.questions.length - 1) {
          html += '<button class="quiz-button quiz-button-success" onclick="nextQuestion()">æ¬¡ã®å•é¡Œã¸ â†’</button>';
        } else {
          html += '<button class="quiz-button quiz-button-success" onclick="showResult()">çµæœã‚’è¦‹ã‚‹</button>';
        }
      }
      
      html += '</div>';
      
      // ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯è¡¨ç¤º
      if (previewState.isAnswered) {
        const isCorrect = checkCurrentAnswer();
        html += `
          <div class="quiz-feedback ${isCorrect ? 'correct' : 'incorrect'}">
            ${isCorrect ? 'âœ“ æ­£è§£ã§ã™!' : 'âœ— ä¸æ­£è§£ã§ã™'}
          </div>
        `;
        
        if (currentQ.explanation) {
          html += `<div class="quiz-feedback" style="background: #fff3cd; border-color: #ffc107; color: #856404;">ğŸ’¡ ${currentQ.explanation}</div>`;
        }
      }
      
      html += '</div>';
      
      container.innerHTML = html;
    }
    
    function renderListQuiz() {
      const container = document.getElementById('preview-quiz-container');
      
      if (previewState.isAnswered) {
        showListResult();
        return;
      }
      
      let html = `
        <div class="quiz-header">
          <div class="quiz-progress">å…¨ ${quizData.questions.length} å•</div>
        </div>
        <div class="quiz-list-mode">
      `;
      
      quizData.questions.forEach((q, index) => {
        html += `
          <div class="quiz-question-card">
            <div class="quiz-question-number">å•é¡Œ ${index + 1}</div>
            <div class="quiz-question-text">${q.question}</div>
        `;
        
        if (q.type === 'choice') {
          html += '<div class="quiz-choices">';
          q.choices.forEach((choice, i) => {
            const isSelected = previewState.userAnswers[index] === i;
            html += `
              <button class="quiz-choice-button ${isSelected ? 'selected' : ''}" 
                      onclick="selectListChoiceAnswer(${index}, ${i})">
                ${choice}
              </button>
            `;
          });
          html += '</div>';
        } else {
          const userAnswer = previewState.userAnswers[index] || '';
          html += `
            <input type="text" 
                   class="quiz-text-input" 
                   id="list-text-answer-${index}"
                   value="${userAnswer}"
                   oninput="updateListTextAnswer(${index}, this.value)"
                   placeholder="ç­”ãˆã‚’å…¥åŠ›ã—ã¦ãã ã•ã„">
          `;
        }
        
        html += '</div>';
      });
      
      html += `
          </div>
          <div class="quiz-buttons">
            <button class="quiz-button quiz-button-success" onclick="submitListQuiz()">æ¡ç‚¹ã™ã‚‹</button>
          </div>
      `;
      
      container.innerHTML = html;
    }
    
    function selectChoiceAnswer(choiceIndex) {
      if (previewState.isAnswered) return;
      previewState.userAnswers[previewState.currentQuestionIndex] = choiceIndex;
      renderSequentialQuiz();
    }
    
    function selectListChoiceAnswer(questionIndex, choiceIndex) {
      previewState.userAnswers[questionIndex] = choiceIndex;
      renderListQuiz();
    }
    
    function updateListTextAnswer(questionIndex, value) {
      previewState.userAnswers[questionIndex] = value;
    }
    
    function checkAnswer() {
      const currentQ = quizData.questions[previewState.currentQuestionIndex];
      
      if (currentQ.type === 'text') {
        const input = document.getElementById('text-answer-input');
        previewState.userAnswers[previewState.currentQuestionIndex] = input.value;
      }
      
      if (previewState.userAnswers[previewState.currentQuestionIndex] === null || 
          previewState.userAnswers[previewState.currentQuestionIndex] === '') {
        alert('âš ï¸ å›ç­”ã‚’é¸æŠã¾ãŸã¯å…¥åŠ›ã—ã¦ãã ã•ã„');
        return;
      }
      
      previewState.isAnswered = true;
      
      if (checkCurrentAnswer()) {
        previewState.score++;
      }
      
      renderSequentialQuiz();
    }
    
    function checkCurrentAnswer() {
      const currentQ = quizData.questions[previewState.currentQuestionIndex];
      const userAnswer = previewState.userAnswers[previewState.currentQuestionIndex];
      
      if (currentQ.type === 'choice') {
        return userAnswer === parseInt(currentQ.answer);
      } else {
        const correctAnswers = [currentQ.answer];
        if (currentQ.answer2) correctAnswers.push(currentQ.answer2);
        if (currentQ.answer3) correctAnswers.push(currentQ.answer3);
        
        return correctAnswers.some(ans => 
          ans.toLowerCase().trim() === userAnswer.toLowerCase().trim()
        );
      }
    }
    
    function nextQuestion() {
      previewState.currentQuestionIndex++;
      previewState.isAnswered = false;
      renderSequentialQuiz();
    }
    
    function submitListQuiz() {
      // æœªå›ç­”ãƒã‚§ãƒƒã‚¯
      const unanswered = previewState.userAnswers.some((ans, i) => {
        if (ans === null || ans === '') return true;
        return false;
      });
      
      if (unanswered) {
        if (!confirm('æœªå›ç­”ã®å•é¡ŒãŒã‚ã‚Šã¾ã™ã€‚ã“ã®ã¾ã¾æ¡ç‚¹ã—ã¾ã™ã‹?')) {
          return;
        }
      }
      
      // ãƒ†ã‚­ã‚¹ãƒˆå…¥åŠ›ã®å€¤ã‚’å–å¾—
      quizData.questions.forEach((q, index) => {
        if (q.type === 'text') {
          const input = document.getElementById(`list-text-answer-${index}`);
          if (input) {
            previewState.userAnswers[index] = input.value;
          }
        }
      });
      
      // æ¡ç‚¹
      previewState.score = 0;
      quizData.questions.forEach((q, index) => {
        const userAnswer = previewState.userAnswers[index];
        
        if (q.type === 'choice') {
          if (userAnswer === parseInt(q.answer)) {
            previewState.score++;
          }
        } else {
          const correctAnswers = [q.answer];
          if (q.answer2) correctAnswers.push(q.answer2);
          if (q.answer3) correctAnswers.push(q.answer3);
          
          if (correctAnswers.some(ans => 
            ans.toLowerCase().trim() === (userAnswer || '').toLowerCase().trim()
          )) {
            previewState.score++;
          }
        }
      });
      
      previewState.isAnswered = true;
      showListResult();
    }
    
    function showListResult() {
      const container = document.getElementById('preview-quiz-container');
      const percentage = Math.round((previewState.score / quizData.questions.length) * 100);
      
      let message = '';
      if (percentage >= 90) message = 'ç´ æ™´ã‚‰ã—ã„!';
      else if (percentage >= 70) message = 'ã‚ˆãã§ãã¾ã—ãŸ!';
      else if (percentage >= 50) message = 'ã‚‚ã†å°‘ã—é ‘å¼µã‚Šã¾ã—ã‚‡ã†!';
      else message = 'å¾©ç¿’ãŒå¿…è¦ã§ã™';
      
      let html = `
        <div class="quiz-result">
          <div class="quiz-result-title">ğŸ‰ çµæœç™ºè¡¨</div>
          <div class="quiz-result-score">${previewState.score} / ${quizData.questions.length}</div>
          <div class="quiz-result-message">${message} (æ­£ç­”ç‡: ${percentage}%)</div>
          <button class="quiz-button quiz-button-primary" onclick="initQuizPreview()" style="max-width: 300px; margin: 0 auto;">ã‚‚ã†ä¸€åº¦æŒ‘æˆ¦</button>
        </div>
        
        <div style="margin-top: 40px;">
          <h3 style="text-align: center; margin-bottom: 20px;">ğŸ“‹ è§£ç­”ä¸€è¦§</h3>
      `;
      
      quizData.questions.forEach((q, index) => {
        const userAnswer = previewState.userAnswers[index];
        let isCorrect = false;
        let correctAnswerText = '';
        
        if (q.type === 'choice') {
          isCorrect = userAnswer === parseInt(q.answer);
          correctAnswerText = q.choices[parseInt(q.answer)];
        } else {
          const correctAnswers = [q.answer];
          if (q.answer2) correctAnswers.push(q.answer2);
          if (q.answer3) correctAnswers.push(q.answer3);
          
          isCorrect = correctAnswers.some(ans => 
            ans.toLowerCase().trim() === (userAnswer || '').toLowerCase().trim()
          );
          correctAnswerText = correctAnswers.join(' / ');
        }
        
        html += `
          <div class="preview-question-item" style="border-left-color: ${isCorrect ? '#27ae60' : '#e74c3c'}">
            <div class="preview-question-header">
              <span class="preview-question-number">å•é¡Œ ${index + 1}</span>
              <span style="color: ${isCorrect ? '#27ae60' : '#e74c3c'}; font-weight: bold;">
                ${isCorrect ? 'âœ“ æ­£è§£' : 'âœ— ä¸æ­£è§£'}
              </span>
            </div>
            <div class="preview-question-text">${q.question}</div>
            <div style="margin-top: 10px;">
              <div style="padding: 8px; background: ${isCorrect ? '#d5f4e6' : '#fadbd8'}; border-radius: 4px; margin-bottom: 5px;">
                <strong>ã‚ãªãŸã®å›ç­”:</strong> ${userAnswer !== null && userAnswer !== '' ? (q.type === 'choice' ? q.choices[userAnswer] : userAnswer) : '(æœªå›ç­”)'}
              </div>
              <div style="padding: 8px; background: #d5f4e6; border-radius: 4px;">
                <strong>æ­£è§£:</strong> ${correctAnswerText}
              </div>
            </div>
            ${q.explanation ? `<div class="preview-explanation">ğŸ’¡ ${q.explanation}</div>` : ''}
          </div>
        `;
      });
      
      html += '</div>';
      
      container.innerHTML = html;
    }
    
    function showResult() {
      const container = document.getElementById('preview-quiz-container');
      const percentage = Math.round((previewState.score / quizData.questions.length) * 100);
      
      let message = '';
      if (percentage >= 90) message = 'ç´ æ™´ã‚‰ã—ã„!';
      else if (percentage >= 70) message = 'ã‚ˆãã§ãã¾ã—ãŸ!';
      else if (percentage >= 50) message = 'ã‚‚ã†å°‘ã—é ‘å¼µã‚Šã¾ã—ã‚‡ã†!';
      else message = 'å¾©ç¿’ãŒå¿…è¦ã§ã™';
      
      container.innerHTML = `
        <div class="quiz-result">
          <div class="quiz-result-title">ğŸ‰ ã‚¯ã‚¤ã‚ºçµ‚äº†!</div>
          <div class="quiz-result-score">${previewState.score} / ${quizData.questions.length}</div>
          <div class="quiz-result-message">${message} (æ­£ç­”ç‡: ${percentage}%)</div>
          <button class="quiz-button quiz-button-primary" onclick="initQuizPreview()" style="max-width: 300px; margin: 0 auto;">ã‚‚ã†ä¸€åº¦æŒ‘æˆ¦</button>
        </div>
      `;
    }
  </script>
</body>
</html>
